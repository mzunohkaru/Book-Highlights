# Claude コンプリートナレッジベース

このドキュメントは、Claude に関する知識、Tips、ベストプラクティスを集約したコンプリートガイドです。

## 更新履歴

最終更新日: 2024 年 6 月 17 日

## 目次

- [プロジェクト管理](#プロジェクト管理)
- [カスタマイゼーション](#カスタマイゼーション)
- [隠しコマンド・テクニック](#隠しコマンドテクニック)
- [開発ワークフロー](#開発ワークフロー)
- [Claude Code 組織運営](#claude-code-組織運営)
- [効率化手法](#効率化手法)
- [トラブルシューティング](#トラブルシューティング)

---

## プロジェクト管理

### 知見管理システム

**基本ディレクトリ構造**:

```
project-root/
├── CLAUDE.md                    # Claude Codeのメイン設定
└── .claude/
    ├── context.md              # プロジェクトの背景・制約
    ├── project-knowledge.md    # 技術的知見・パターン
    ├── project-improvements.md # 改善履歴・教訓
    ├── common-patterns.md      # 頻用コマンドパターン
    ├── debug-log.md           # 重要なデバッグ記録
    └── debug/                 # 一時的なデバッグファイル
        ├── sessions/          # セッション別ログ
        ├── temp-logs/         # 作業中の一時ファイル
        └── archive/           # 解決済み問題の保管
```

**ファイル別役割**:

- **CLAUDE.md**: プロジェクト概要と Claude への指示
- **context.md**: プロジェクトの背景、制約条件、技術選定理由
- **project-knowledge.md**: アーキテクチャ決定、実装パターン、避けるべきパターン
- **project-improvements.md**: 改善履歴、試行錯誤記録
- **common-patterns.md**: 頻用コマンドパターン、定型実装

**デバッグ情報管理**:
永続化ルール（以下を満たす問題を debug-log.md に記録）:

- 解決に 30 分以上要した問題
- 再発の可能性が高い問題
- チーム全体で共有すべき知見

### Obsidian & GitHub Actions 連携

**システムアーキテクチャ**:
ローカル Obsidian（知の源泉） → GitHub Actions（自動化） → Claude（分析） → GitHub Issues（ダッシュボード）

**Obsidian フォルダ構成**:

```
📁 01_Projects/: 案件ごとのノート
📁 02_Resources/: 顧客・メンバー情報
📁 03_Meetings/: 議事録ノート
📁 04_Assignments/: アサイン関係性定義
📁 05_Daily/: デイリータスク・メモ
📁 _Templates/: 各ノートのひな形
```

---

## カスタマイゼーション

### カスタムスラッシュコマンド

**配置場所**:

- 全プロジェクト共通: `~/.claude/commands/` (Prefix: `/user:`)
- 個別プロジェクト: `.claude/commands/` (Prefix: `/project:`)

**ファイル構成例**:

```
.claude/
├── commands/  # カスタムスラッシュコマンド定義
│   ├── sphinx-build.md
│   ├── sphinx-create.md
│   └── sphinx-update.md
├── docs/
│   ├── CLAUDE.md  # システムドキュメント
│   └── config/    # 設定ファイル
```

**使用方法**:

```bash
# 初期化
/project:sphinx-create

# 設定更新
/project:sphinx-update

# ビルド
/project:sphinx-build
```

### Orchestrator（複雑タスクの分解実行）

**効果的な指示**:

- 大雑把なコード調査後、サブタスク分割とステップ計画
- サブタスク実行ステップ内の並列化
- ステップごとの計画妥当性再考
- アジャイル的アプローチで手戻り最小化

**コマンド例**:

```
.claude/commands/
├── orchestrator.md      # 複雑なタスクの分解実行
└── commit-with-check.md # テスト後のコミット
```

### /init コマンド活用

**実行タイミング**:

- 初回導入時: .claude/ディレクトリの作成と初期セットアップ
- 知見ファイル大幅更新後: project-knowledge.md や context.md の重要変更後
- 新メンバー参加時: 最新プロジェクトコンテキストの反映
- 定期メンテナンス後: 月 1 回程度の知見整理やファイル構造変更後

---

## 隠しコマンド・テクニック

### 拡張思考（Extended Thinking）キーワード

**最大予算**:

- `熟考`
- `深く考えて`
- `しっかり考えて`

**中予算**:

- `もっと考えて`
- `たくさん考えて`
- `よく考えて`
- `長考`

**小予算**:

- `想`
- `思考`

### 段階的アプローチ

1. 簡単なバグ修正: `think`
2. アーキテクチャ設計: `think deeply`
3. 複雑なアルゴリズム最適化: `ultrathink`

### 基本コマンド

- `-c` オプション: 直前の会話のコンテキストを保持したまま継続
- `#` で始まる入力: メモリに保存
- `\ ` または `Option+Enter`: 複数行入力

### スラッシュコマンド

```bash
/compact    # 会話を圧縮（長い会話をまとめる）
/doctor     # Claude Codeの動作状況をチェック
/vim        # Vimキーバインドを有効化
/memory     # メモリファイルを直接編集
/init       # プロジェクトの初期設定・最新状態反映
```

### 便利なフラグ

```bash
claude --output-format json    # JSON形式で出力（スクリプト向け）
claude --verbose              # デバッグ用の詳細出力
claude --max-turns 5          # 自動実行の最大ターン数制限
claude --dangerously-skip-permissions  # 権限チェックをスキップ（自己責任）
```

---

## 開発ワークフロー

### 指示の粒度とアウトプット評価

- 指示の粒度が１回り大きくても対応可能
- 自律時間が 1 時間程度持続
- CLAUDE.md とドキュメントの合わせ技で迷いを防止
- Cursor Rules の CLAUDE.md への移植が機能

### トークン使用量削減アプローチ

**1. コード生成の最適化**:

- 具体的な指示
- 段階的な開発

**2. コンテキスト管理の最適化**:

- 必要最小限のファイル共有
- repomix ツールの活用（XML 形式で Claude 最適化出力）
- 部分的更新の活用

**3. 事前設計によるトークン節約**:

- 通常の Claude で設計相談・アーキテクチャ検討
- Claude Code で明確な指示による一発実装

**効果的なワークフロー**:

```
Step 1: 設計相談（通常のClaude）
Step 2: 実装（Claude Code）
Step 3: 問題発生時の対処（必要に応じて）
```

### GitHub Actions 統合

**レビューフロー**:

1. `@claude レビューして`
2. 修正
3. `@claude 再レビューして`
4. GitHub 上でコミュニケーション完結

**カスタマイズ**:

- CLAUDE.md で挙動をカスタマイズ
- `/init`で CLAUDE.md 作成
- プロジェクト固有のルールに従ったレビュー

---

## Claude Code 組織運営

### Claude Code Company 組成

**概要**: Claude Code の並列処理を組織化して開発効率を最大化する手法

**組織構成**（12 メンバー体制）:

- **総司令官（メイン）**: 1 名 - 黒
- **マネージャー**: 2 名 - コンテクスト維持
- **サマリー役**: 1 名 - コンテクスト維持
- **メンバー**: 4,5 名をマネージャー配下へアサイン

**役割定義**:

- **総司令官**: 仕様理解、リーダーシップ、リソース管理、プロジェクト状態管理
- **マネージャー**: チームのパフォーマンス最大化、部下のアサイン
- **サマリー役**: 進捗記録、状態のサマリー化、総司令官への定期報告
- **メンバー**: タスクの自立的遂行、進捗報告、判明事実の報告

---

## 効率化手法

### 超並列開発（Git Worktree 活用）

**概要**: 同じリポジトリで複数のタスクを同時実行

**Git Worktree の利点**:

- 1 つのリポジトリの複数ブランチを別フォルダとして並列作業
- 各ブランチを VSCode で同時に開ける
- 物理的なフォルダ分離により混乱を防止

**成功のための 6 つのヒント**:

1. **環境構築はシンプルに**: 複雑な環境は避け、Docker の活用推奨
2. **指示用 Markdown ファイル**: ISSUE.md などでタスク別の指示書作成
3. **ポート分けで同時デバッグ**: 異なるポートで複数環境を並列実行
4. **Peacock で色分け**: タスク種類別に色分け（機能追加=赤、バグ修正=青、リファクタリング=緑）
5. **完了通知の確実な受け取り**: `echo -e "\a"`コマンドで音声通知
6. **コンフリクトリスク軽減**: こまめな main 取り込み

### プロンプトハック（産業レベルコード生成）

**効果的なキーワード**:

- `deep dive`（深掘り）
- `comprehensive`（包括的な）
- `analyze`（分析する）
- `evaluate`（評価する）
- `research`（調査する）

**システムプロンプト構成要素**:

- タスクの詳細
- 技術要件
- コアコンポーネント
- 品質基準
- 実装ガイドライン
- 必須機能
- コード品質
- 出力形式
- 追加指示

---

## トラブルシューティング

### Claude Code 固まり対策

**主な対処法**:

- `claude -c`: コンテキスト保持で会話継続
- `/clear`: コンテキストリセット
- `/doctor`: 動作状況チェック

### 並列組織管理（tmux 活用）

**ベストプラクティス**:

1. **明確な役割分担**: pane 番号伝達、具体的タスク指示
2. **効率的なコミュニケーション**: ワンライナー報告、[pane 番号]プレフィックス
3. **トークン使用量管理**: 定期的な/clear 実行、ccusage での監視
4. **エラー対処**: Web 検索指示、具体的エラー共有

**状況確認コマンド**:

```bash
# pane状況確認
tmux list-panes -t session_name

# 全pane一括確認
tmux capture-pane -t session_name:window.pane -p
```

---

## まとめ

Claude Code を最大限活用するためのポイント：

1. **組織化**: Claude Code Company で並列処理を最適化
2. **ナレッジ管理**: .claude ディレクトリでの体系的知見蓄積
3. **効率化**: Git Worktree による超並列開発
4. **自動化**: GitHub Actions と Obsidian の連携
5. **カスタマイゼーション**: プロジェクト特化コマンドの作成
6. **トークン最適化**: 事前設計と段階的実装によるコスト削減

これらの手法を組み合わせることで、Claude Code を単なるコーディングツールから、包括的な開発プラットフォームへと進化させることができます。
